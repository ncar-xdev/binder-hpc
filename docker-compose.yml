networks:
  network:
    name: cluster.net
    driver: bridge

volumes:
  alpha-home:
  beta-home:
  gamma-home:

services:
  jupyterhub:
    build:
      context: images/jupyterhub/
    image: jupyterhub
    container_name: jupyterhub
    hostname: jupyterhub
    networks:
      - network
    environment:
      - PBS_SERVER=pbsserver
    ports:
      - 8000:8000
      - 8081:8081
    volumes:
      - alpha-home:/home/alpha
      - beta-home:/home/beta
      - gamma-home:/home/gamma

  head:
    build:
      context: images/head/
    image: head
    container_name: head
    hostname: head
    networks:
      - network
    environment:
      - PBS_SERVER=pbsserver
    volumes:
      - alpha-home:/home/alpha
      - beta-home:/home/beta
      - gamma-home:/home/gamma

  pbsserver:
    build:
      context: images/pbsserver/
    image: pbsserver
    container_name: pbsserver
    hostname: pbsserver
    networks:
      - network
    command: ["node"]

  node:
    build:
      context: images/pbsmom/
    depends_on:
      - pbsserver
    image: pbsmom
    container_name: node
    hostname: node
    networks:
      - network
    environment:
      - PBS_SERVER=pbsserver
    volumes:
      - alpha-home:/home/alpha
      - beta-home:/home/beta
      - gamma-home:/home/gamma
